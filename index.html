<link href='https://fonts.googleapis.com/css?family=Bangers|Josefin+Slab' rel='stylesheet' type='text/css'>
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Legend Ferrari in Formula One</title>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js"></script>
   <script src="https://d3js.org/queue.v1.min.js"></script>


    <link rel="stylesheet" type="text/css" href="css/barchart.css">
    <link rel="stylesheet" type="text/css" href="css/linestyle.css">
  </head>

  <body>
    <div id="main">
    <div id="ms1">
      <div id= "introms1">
        <h1>2000 - 2006</h1>
        <h2>"Michael Schumacher Years"</h2>
        <p>Year 2000 was a special year for the Formula One Ferrari team and all fans of Ferrari around the world. After 20 years' failure of winning the Driver Championship, Ferrari finally gained this honor again in the 2000 season.<p>
        <p>The hero was Michael Schumacher, who joined Ferrari from season 1996, and started his five-year championships from this special season 2000.</p>
      </div>
    </div>

    <div id="ms2">
      <div id="introms2">
        <h2>Michael Schumacher and Team Ferrari's performance from season 2000 - 2006</h2>
        <div id= "mslinechart1" class="driverchart"></div>
        <div id= "mslinechart2" class = "teamchart"></div>
        <p id="introms21" class = "ms21">Season 2000 to season 2004 are "winner years" to both Michael Schumacher and Team Ferrari. They undertook both the championships of driver and team, which made Michael Schumacher become deserve the name of ‚ÄùKing of F1".</p>
        <p class = "ms21">However, due to new rules of tyre and the backward of race car research and development, Ferrari race cars' failed to challenge team Renault in both season 2005 and 2006, and Fernando Alonso became world champion instead of Michael Schumacher. After season 2006, Michael Schumacher chose to retire from F1.</p>
      </div>

    </div>

    <div id = "ms3">
      <div id="introms3">
      <h2>Michael Schumacher's Record</h2>

      <div id="ms3p">
        <p>There is no doubt that Michael Schumacher was one of the greatest Formula One drivers in the world. Although he has retired for several years, he still maintains multiple records in the field of Formula One, which is hard to be surpass by other F1 drivers.</p>
      </div>
      <div id="barmenu">
          <select>
          <option value ="pole">Pole</option>
          <option value="inPoint">InPoint Race</option>
          <option value="FastLap">Fastest Lap</option>
          <option value="WinfromPole">Win From pole</option>

          </select>
      </div>
      <div id="msbarchart"></div>
    </div>


    </div>
  </div>


    <script type="text/javascript">
    //This is the script for the whole page, which make every section has the window size.
     var pagewidth = window.innerWidth;
     var pageheight = window.innerHeight;

     function resize(d) {

       document.getElementById(d).style.height = pageheight + "px";
       document.getElementById(d).style.width = pagewidth + "px";
     };


      resize("ms1");
      resize("ms2");
      resize("ms3");

      window.onresize = function() {
        resize("ms1");
        resize("ms2");
        resize("ms3");
      };

    //global variable


    var dateFormat = d3.time.format("%Y");



    //The first line chart here.
    var linefullwidth = 800;
    var linefullheight = 500;
    var linemargin = {top:50, right: 150, bottom: 50, left:80};
    var linewidth = linefullwidth - linemargin.left - linemargin.right;
    var lineheight = linefullheight - linemargin.top - linemargin.bottom;
    var linechart1 = d3.select("#mslinechart1")
        .append("svg")
        .attr("width", linefullwidth)
        .attr("height", linefullheight)
        .append("g")
        .attr("transform", "translate(" + linemargin.left + "," + linemargin.top + ")");
    var linexScale = d3.time.scale()
               .range([0,linewidth]);

    var lineyScale = d3.scale.linear()
              .range([0, lineheight]);

    var linexAxis = d3.svg.axis()
        .scale(linexScale)
        .orient("bottom")
        .ticks(10)
        .tickFormat(function(d){
          return dateFormat(d);
        })
        .innerTickSize([10])
        .outerTickSize([10]);

    var lineyAxis = d3.svg.axis()
        .scale(lineyScale)
        .orient("left")
        .outerTickSize([10]);

    var line = d3.svg.line()
        .x(function(d){
          return linexScale(dateFormat.parse(d.year));
        })
        .y(function(d){
          return lineyScale(+d.point);
        });

    var linecharttooltip1 = d3.select("#mslinechart1")
        .append("div")
        .attr("class","linecharttooltip1");

    d3.csv("data/Drivertotal.csv", function(data){
      console.log(data);
      var years = ["2000","2001","2002","2003","2004","2005","2006"];
      var teams = ["Team2000","Team2001","Team2002","Team2003","Team2004","Team2005","Team2006"];

      var fulldata = [];
     data.forEach(function(d,i){
       var performance=[];
       var team = [];
       years.forEach(function(y){
         if(d[y]){
           performance.push({
             year: y,
             point: d[y],
             driver: d["Drivername"],
             team: d["Team"+ y]
           });
         }
       });


      fulldata.push({
        driver:d.Drivername,
        performance: performance,
        team: team
      });

     });
     console.log(fulldata);

    linexScale.domain(
      d3.extent(years, function(d){
        return dateFormat.parse(d);
      })
    );

    lineyScale.domain([
      d3.max(fulldata, function(d){
        return d3.max(d.performance, function(d){
          return +d.point;
        });
      }),
      0
    ]);

    var drawline = linechart1.selectAll("g.lines")
       .data(fulldata)
       .enter()
       .append("g")
       .attr("class","lines")
       .on("mouseover", mouseoverline)
       .on("mouseout", mouseoutline)
       ;

    drawline.selectAll("path")
       .data(function(d){
         return [d.performance];
        })
       .enter()
       .append("path")
       .attr("class","line")
       .attr("d",line)
       .style("stroke", function(d,i){
         if (d[i].driver === "Michael Schumacher"){
           return "red";
         } if(d[i].driver === "Fernando Alonso") {
           return "rgb(30,164,224)"; }else {
           return "gray";
         }
       });



    var linecircles = drawline.selectAll("circle")
        .data(function(d){
          return d.performance;
        })
        .enter()
        .append("circle");

    linecircles.attr("cx", function(d){
      return linexScale(dateFormat.parse(d.year));
    })
      .attr("cy", function(d){
        return lineyScale(+d.point);
      })
      .attr("r",3)
      .style("opacity", 0);

    linecircles
    .on("mouseover", mouseovercircle)
    .on("mousemove", mousemovecircle)
    .on("mouseout",mouseoutcircle);

    drawline.append("text")
    .datum(function(d){
      return{
        name: d.driver,
        value: d.performance[d.performance.length -1]
      };
    })
    .attr("transform", function(d){
        return "translate("+ (linewidth + 3) + "," + lineyScale(+d.value.point) +")";
      })
      .attr("x",3)
      .attr("dy", "1px")
      .text(function(d){
        return d.name;
      })
      .classed("linenamelabel",true);

     d3.selectAll(".linenamelabel")
     .classed("hidden", function(d,i){
       if (i === 0 || i === 25) {
         return false;
       }else {
         return true;
       }
     });

     linechart1.append("g")
       .attr("class","linexaxis")
       .attr("transform", "translate(0," + lineheight + ")")
			 .call(linexAxis);

		 linechart1.append("g")
					.attr("class", "lineyaxis")
					.call(lineyAxis);

      d3.selectAll("g.lines")
        .on("mouseover", mouseoverline)
        .on("mouseout", mouseoutline);

      linechart1.append("text")
        .attr("class", "linexlabel")
        .attr("transform", "translate(" + (linemargin.left + linewidth / 2) + " ," +
                                (lineheight + linemargin.bottom) + ")")
         .style("text-anchor", "middle")
         .attr("dy", "-1px")
         .attr("dx", "-70px")
         .text("Season");

       linechart1.append("text")
       .attr ("class", "lineylabel")
      .attr("transform", "rotate(-90)")
      .attr("y", 0 - linemargin.left) // you may need to adjust this
      .attr("x", 0 - (lineheight / 2)) // you may need to adjust
      .attr("dy", "3em")
      .style("text-anchor", "middle")
      .text("Total Points");

      function mouseoverline(d) {
        d3.selectAll("path.line").classed("unfocused", true);
        d3.select(this).select("path.line").classed("unfocused",false).classed("focused", true);

        d3.selectAll(".linenamelabel").classed("unfocused",true);
        d3.select(this).select(".linenamelabel").classed("hidden",false).classed("focused",true);
      }

      function mouseoutline(d){
        d3.selectAll("path.line").classed("unfocused",false).classed("focused",false);
        linecharttooltip1.style("display","none");
        d3.selectAll(".linenamelabel").classed("focused",false).classed("hidden",function(d,i) {
          if (i=== 0 || i === 25) {
            return false;
          } else {
            return true;
      }
    });
  }

      function mouseovercircle(d){
        d3.select(this)
        .transition()
        .style("opacity",1)
        .style("fill", function(d){
          if (d.driver==="Michael Schumacher"){
            return "red";
          } if(d.driver ==="Fernando Alonso") {
            return "rgb(30,164,224)";} else {
            return "gray";
          }
        })
        .attr("r",6);

        linecharttooltip1
        .style("display",null)
        .html("<p>Driver:" + d.driver + "</br>Season:" + d.year + "</br>Points:" + d.point + "</p>");
      }

      function mousemovecircle(d){
        linecharttooltip1
        .style("top", (d3.event.pageY + 5) + "px" )
        .style("left", (d3.event.pageX - 240) + "px");
      }

      function mouseoutcircle(d){
        d3.select(this)
        .transition()
        .style("opacity",0)
        .attr("r",3);

        linecharttooltip1
        .style("display","none");
      }
      //linechart end.



  });

//barchart for Michael Schumacher's record begin.
  var barfullwidth = 800;
  var barfullheight = 500;
  var barmargin= {top:20, right: 50, bottom: 20, left:100};

  var barheight = barfullheight - barmargin.top - barmargin.bottom;
  var barwidth = barfullwidth - barmargin.left - barmargin.right;

  var drawbarchart = d3.select("#msbarchart")
     .append("svg")
     .attr("width", barfullwidth)
     .attr("height", barfullheight)
     .append("g")
     .attr("transform", "translate(" + barmargin.left + "," + barmargin.top + ")");

  drawbarchart.append("g")
       .attr("class","barxaxis");
 var barbuttons = d3.selectAll("button")
          .classed("barbutton", true);

  var barxScale = d3.scale.linear()
       .range([0,barwidth]);

  var baryScale = d3.scale.ordinal()
       .rangeRoundBands([0,barheight], .1);

  var barxAxis = d3.svg.axis()
      .scale(barxScale)
      .orient("top")
      .ticks(10)
      .innerTickSize([5])
      .outerTickSize([5]);

  var bartooltip = d3.select("#msbarchart")
      .append("div")
      .attr("class","bartooltip");

  d3.csv("data/pole.csv", function(error,data){
     var barvalue = d3.select("#barmenu select").property("value")
     var bardata = top10(data, barvalue);

     console.log(barvalue);

     d3.select("#barmenu select")
        .on("change", function(){
          barvalue = d3.select("#barmenu select").property("value");
          bardata = top10(data, barvalue);
        redraw(bardata, barvalue);
      });
  });

  function top10(bardata, barvalue){
    bardata.sort(function(a,b){
      return d3.descending(+a[barvalue], +b[barvalue]);
    })
    slicedata = bardata.slice(0,15);

    redraw(slicedata, barvalue);
  }

  function redraw(bardata, barvalue) {
    var barmax = d3.max(bardata, function(d){
      return +d[barvalue];
    });

    barxScale.domain([0,barmax]);

    baryScale.domain(d3.range(bardata.length));


    var bars = drawbarchart.selectAll("rect.bar")
        .data(bardata, function(d){
          return d.Drivername;
        });

        bars
        .attr("fill","gray")
        .attr("opacity","0.2");



   bars.enter()
       .append("rect")
       .attr("class", "bar")
       .attr("fill", function(d){
         if (d.Drivername==="Michael Schumacher") {
           return "red";
         } else {
           return "gray";
         }
       })
       .attr("opacity", 0.4)
       .on("mouseover",mouseoverBar)
       .on("mouseout", mouseoutBar);

    bars.exit()
       .transition()
       .duration(300)
       .attr("width",0)
       .remove();

    bars
       .transition()
       .duration(500)
       .ease("quad")
       .attr("width",function(d){
         return barxScale(+d[barvalue]);
       })
       .attr("height", baryScale.rangeBand())
       .attr("fill", function(d){
         if(d.Drivername ==="Michael Schumacher"){
           return "red";
         } else {
           return "gray";
         }
       })
       .attr("opacity",0.4)
       .attr("transform", function(d,i) {
                               return "translate(0," + baryScale(i) + ")";
                           });
    drawbarchart.transition().select(".barxaxis")
    .call(barxAxis);

    var barlabel = drawbarchart.selectAll("text.barlabels")
       .data(bardata, function(d){
         return d.Drivername;
       });

    barlabel.enter()
       .append("text")
       .attr("class", "barlabels");

    barlabel.exit()
       .remove();

    barlabel.transition()
       .duration(500)
       .text(function(d){
         return +d[barvalue];
       })
       .attr("x",function(d){
         return barxScale(+d[barvalue]);
       })
       .attr("y",function(d,i){
         return baryScale(i);
       })
       .attr("dy","1.2em")
       .attr("dx", "1.8em")
       .attr("text-anchor","end");

    var barlabeldriver = drawbarchart.selectAll("text.barlabeldriver")
       .data(bardata, function(d){
         return d.Drivername;
       });

    barlabeldriver.enter()
      .append("text")
      .attr("class", "barlabeldriver");

    barlabeldriver.exit()
      .remove();

    barlabeldriver.transition()
      .duration(500)
      .text(function(d){
        return d.Drivername;
      })
      .attr("x",-3)
      .attr("transform", function(d,i) {
              return "translate(" + 0+ "," + baryScale(i) + ")"
      })
      .attr("dy", "15px")
      .attr("dx", "-3px")
      .attr("text-anchor", "end");


      function mouseoverBar(d) {
      d3.select(this)
        .classed("barfocused", true)
        .classed("barunfocused", false)

      bartooltip
      .style("display", null)
      .html("<p>Driver:" + " " +d.Drivername +
            "</p>")
            .style("top", (d3.event.pageY - 10) + "px" )
            .style("left", (d3.event.pageX + 10) + "px");

    }

    function mouseoutBar(d) {
      d3.select(this)
      .classed("barfocused", false)
      .classed("barunfocused", true)

      bartooltip
      .style("display","none");

    }



  }












    </script>
  </body>
  </html>
